metadata:
  name: opensearch-dashboards-${THIS_NAMESPACE}
  namespace: argocd
spec:
  destination:
    namespace: ${THIS_NAMESPACE}
    server: https://kubernetes.default.svc
  project: default
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
    - ServerSideApply=false
  source:
    path: charts/opensearch-dashboards
    repoURL: ${THIS_REPO_URL}
    targetRevision: HEAD
    helm:
      values: |
        opensearchHosts: "${THIS_OPENSEARCH_SVC_HOST}"
        ingress:
          enabled: true
          # For Kubernetes >= 1.18 you should specify the ingress-controller via the field ingressClassName
          # See https://kubernetes.io/blog/2020/04/02/improvements-to-the-ingress-api-in-kubernetes-1.18/#specifying-the-class-of-an-ingress
          ingressClassName: ${THIS_CLUSTER_INGRESS}
          annotations:
            nginx.ingress.kubernetes.io/rewrite-target: /
            cert-manager.io/cluster-issuer: ${THIS_CLUSTER_ISSUER}
            spec.ingressClassName: ${THIS_CLUSTER_INGRESS}
          hosts:
            - host: "${THIS_OPENSEARCH_DASH_HOST}.${THIS_DOMAIN}"
              paths:
                - path: /
                  backend:
                    serviceName: "opensearch-dashboards"
                    servicePort: 5601
          tls:
            - secretName: ${THIS_NAME}-opensearch-dashboards-tls
              hosts:
                - "${THIS_OPENSEARCH_DASH_HOST}.${THIS_DOMAIN}"
        ## Enable to add 3rd Party / Custom plugins not offered in the default OpenSearchDashboards image.
        plugins:
          enabled: false
          installList: []
          # - example-fake-plugin-downloadable-url
          removeList: []
          # - examplePluginName
        config:
          # Default OpenSearch Dashboards configuration from docker image of Dashboards
        
          opensearch_dashboards.yml: |
            server:
              name: dashboards
              host: "{{ .Values.serverHost }}"
            data_source.enabled: true
            workspace.enabled: true
            explore.enabled: true
        
          #  opensearch_dashboards.yml:
          #   server:
          #     name: dashboards
          #     host: "{{ .Values.serverHost }}"
        
        
          # Dashboards TLS Config (Ensure the cert files are present before enabling SSL
          # ssl:
          #   enabled: true
          #   key: /usr/share/opensearch-dashboards/certs/dashboards-key.pem
          #   certificate: /usr/share/opensearch-dashboards/certs/dashboards-crt.pem
        
          # determines how dashboards will verify certificates (needs to be none for default opensearch certificates to work)
          # opensearch:
          #   ssl:
          #     certificateAuthorities: /usr/share/opensearch-dashboards/certs/dashboards-root-ca.pem
          #     if utilizing custom CA certs for connection to opensearch, provide the CA here
